<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Capacitor Command - LCARS</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* --- LCARS / TRICORDER THEME --- */
        @import url('https://fonts.googleapis.com/css2?family=Antonio:wght@400;700&family=Roboto+Condensed:wght@400;700&display=swap');

        :root {
            --lcars-bg: #000000;
            --lcars-orange: #ff9c00;
            --lcars-pale: #ffcc99;
            --lcars-purple: #cc99cc;
            --lcars-blue: #99ccff;
            --lcars-red: #cc6666;
            --lcars-gray: #444444;
        }

        body { 
            background-color: var(--lcars-bg); 
            color: var(--lcars-blue); 
            -webkit-tap-highlight-color: transparent; 
            font-family: 'Antonio', 'Roboto Condensed', 'Arial Narrow', sans-serif;
            text-transform: uppercase;
            overflow-x: hidden;
        }

        /* Typography */
        .lcars-text { font-family: 'Antonio', sans-serif; letter-spacing: 1px; }
        .tech-text { font-family: 'Roboto Condensed', monospace; }

        /* Custom Inputs */
        input { 
            font-family: 'Roboto Condensed', monospace !important;
            background: #000 !important;
            border: 2px solid var(--lcars-gray) !important;
            color: var(--lcars-orange) !important;
            border-radius: 999px !important; 
            padding-left: 20px !important;
            text-transform: uppercase;
            outline: none !important;
        }

        /* Number inputs (large, right aligned) */
        input[type="number"] {
            font-size: 24px !important; 
            text-align: right;
            padding-right: 20px !important;
        }
        
        /* Text inputs (smaller, left aligned) */
        input[type="text"] {
            font-size: 16px !important; 
            text-align: left;
            height: 45px !important;
        }

        input:focus {
            border-color: var(--lcars-blue) !important;
            box-shadow: 0 0 15px rgba(153, 204, 255, 0.2) !important;
        }

        /* Animations */
        .scan-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.5) 51%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 100;
            opacity: 0.15;
        }

        .lcars-btn:active {
            transform: scale(0.98);
            filter: brightness(1.2);
        }
    </style>
</head>
<body class="min-h-screen pb-10">
    <div class="scan-overlay"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICONS ---
        const Icons = {
            Bolt: ({size=24, ...p}) => <svg width={size} height={size} {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>,
            Trash: ({size=24, ...p}) => <svg width={size} height={size} {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Save: ({size=24, ...p}) => <svg width={size} height={size} {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>,
            Copy: ({size=24, ...p}) => <svg width={size} height={size} {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>,
            Video: ({size=24, ...p}) => <svg width={size} height={size} {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
        };

        // --- LCARS COMPONENTS ---
        const LCARSHeader = ({ title, subTitle }) => (
            <div className="flex flex-col mb-6">
                <div className="flex items-end">
                    <div className="w-24 h-6 bg-[#ff9c00] rounded-tl-full rounded-bl-none mr-2"></div>
                    <div className="flex-1 h-6 bg-[#ff9c00] flex items-center justify-between px-4 text-black font-bold text-lg leading-none pt-1">
                        <span className="lcars-text">{title}</span>
                    </div>
                </div>
                <div className="flex h-full">
                    <div className="w-24 bg-[#ffcc99] min-h-[40px] rounded-bl-full flex flex-col items-end pr-2 pt-2 border-b-4 border-[#ff9c00]">
                        <span className="text-black text-[10px] font-bold">SYS-4</span>
                    </div>
                    <div className="flex-1 pt-2 px-2 flex justify-between items-start text-[#ff9c00]">
                        <span className="text-xs tracking-widest opacity-80">{subTitle}</span>
                        <div className="h-1 bg-[#cc99cc] w-1/3"></div>
                    </div>
                </div>
            </div>
        );

        const LCARSButton = ({ onClick, color = "bg-[#ff9c00]", text, icon, active, className }) => (
            <button onClick={onClick} className={`lcars-btn relative overflow-hidden ${active ? 'bg-white text-black' : color + ' text-black'} font-bold uppercase tracking-wider rounded-full flex items-center justify-center gap-2 h-10 px-6 text-sm transition-all ${className}`}>
                {icon}
                {text}
            </button>
        );

        const FormField = ({ label, value, onChange, placeholder, type="number", color="#99ccff" }) => (
            <div className="flex flex-col">
                <label className="text-[10px] font-bold mb-1 ml-4 block" style={{color: color}}>{label}</label>
                <input 
                    type={type} 
                    className="w-full"
                    placeholder={placeholder} 
                    value={value} 
                    onChange={onChange}
                    step="0.1"
                    autoComplete="off"
                    style={{borderColor: color, color: color}}
                />
            </div>
        );

        function App() {
            const [mode, setMode] = useState('single'); 
            
            // System Identity
            const [sysInfo, setSysInfo] = useState({ name: '', mfg: '', model: '', serial: '' });

            // Single Mode State
            const [singleVoltage, setSingleVoltage] = useState('');
            const [singleRated, setSingleRated] = useState('');
            const [singleAmps, setSingleAmps] = useState('');

            // Dual Mode State (Split)
            const [hermVoltage, setHermVoltage] = useState('');
            const [hermRated, setHermRated] = useState('');
            const [hermAmps, setHermAmps] = useState('');
            
            const [fanVoltage, setFanVoltage] = useState('');
            const [fanRated, setFanRated] = useState('');
            const [fanAmps, setFanAmps] = useState('');

            const calculate = (rated, amps, volts) => {
                if (!rated || !amps || !volts) return null;
                const r = parseFloat(rated);
                const a = parseFloat(amps);
                const v = parseFloat(volts);
                if (v === 0) return null;

                const calc = (a * 2652) / v;
                const diff = (calc - r) / r;
                const percentOff = diff * 100;
                const passed = Math.abs(percentOff) <= 6; 

                return {
                    rated: r.toFixed(1),
                    calculated: calc.toFixed(2),
                    percentOff: percentOff.toFixed(1),
                    passed
                };
            };

            const singleResult = useMemo(() => calculate(singleRated, singleAmps, singleVoltage), [singleRated, singleAmps, singleVoltage]);
            const hermResult = useMemo(() => calculate(hermRated, hermAmps, hermVoltage), [hermRated, hermAmps, hermVoltage]);
            const fanResult = useMemo(() => calculate(fanRated, fanAmps, fanVoltage), [fanRated, fanAmps, fanVoltage]);

            const clearAll = () => {
                setSysInfo({ name: '', mfg: '', model: '', serial: '' });
                setSingleVoltage(''); setSingleRated(''); setSingleAmps('');
                setHermVoltage(''); setHermRated(''); setHermAmps('');
                setFanVoltage(''); setFanRated(''); setFanAmps('');
            };

            const generateReport = () => {
                const now = new Date().toLocaleString();
                let report = `STARFLEET ENGINEERING REPORT\nSTARDATE: ${new Date().getTime()}\n-------------------------\n`;
                
                // Add System Info
                if (sysInfo.name) report += `SYSTEM ID:    ${sysInfo.name.toUpperCase()}\n`;
                if (sysInfo.mfg)  report += `MANUFACTURER: ${sysInfo.mfg.toUpperCase()}\n`;
                if (sysInfo.model) report += `MODEL NO:     ${sysInfo.model.toUpperCase()}\n`;
                if (sysInfo.serial) report += `SERIAL NO:    ${sysInfo.serial.toUpperCase()}\n`;
                report += `-------------------------\n`;

                if (mode === 'single' && singleResult) {
                    report += `UNIT: SINGLE RUN CAPACITOR\n`;
                    report += `INPUT VOLTAGE: ${singleVoltage}V\n`;
                    report += `RATED: ${singleResult.rated} uF\n`;
                    report += `ACTUAL: ${singleResult.calculated} uF\n`;
                    report += `VARIANCE: ${singleResult.percentOff}%\n`;
                    report += `DIAGNOSTIC: ${singleResult.passed ? 'PASS' : 'FAIL'}\n`;
                } else if (mode === 'dual') {
                    if (hermResult) {
                        report += `UNIT: DUAL - HERM (COMPRESSOR)\n`;
                        report += `INPUT VOLTAGE: ${hermVoltage}V\n`;
                        report += `RATED: ${hermResult.rated} uF\n`;
                        report += `ACTUAL: ${hermResult.calculated} uF\n`;
                        report += `VARIANCE: ${hermResult.percentOff}%\n`;
                        report += `DIAGNOSTIC: ${hermResult.passed ? 'PASS' : 'FAIL'}\n\n`;
                    }
                    if (fanResult) {
                        report += `UNIT: DUAL - FAN\n`;
                        report += `INPUT VOLTAGE: ${fanVoltage}V\n`;
                        report += `RATED: ${fanResult.rated} uF\n`;
                        report += `ACTUAL: ${fanResult.calculated} uF\n`;
                        report += `VARIANCE: ${fanResult.percentOff}%\n`;
                        report += `DIAGNOSTIC: ${fanResult.passed ? 'PASS' : 'FAIL'}\n`;
                    }
                }
                report += `\n-------------------------\nCreated by Clint Glasgow and his silicon buddy Gemini`;
                return report;
            };

            const copyToClipboard = () => {
                const text = generateReport();
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try { document.execCommand('copy'); alert("LOG COPIED TO BUFFER"); } 
                catch (err) { alert("BUFFER ERROR"); }
                document.body.removeChild(textArea);
            };

            const downloadTxt = () => {
                const text = generateReport();
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `CAPACITOR_LOG_${new Date().getTime()}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            };

            // ** NEW VIDEO LINK FUNCTION **
            const openTrainingVideo = () => {
                window.open("https://www.youtube.com/watch?v=B-oayla2IAU", "_blank");
            };

            return (
                <div className="max-w-xl mx-auto min-h-screen bg-black border-x-4 border-[#222] relative flex flex-col">
                    {/* Top Decorator */}
                    <div className="h-2 bg-[#cc6666] w-full mb-1"></div>
                    <div className="flex gap-1 h-2 w-full mb-2">
                        <div className="bg-[#ff9c00] w-2/3"></div>
                        <div className="bg-[#99ccff] w-1/3"></div>
                    </div>

                    <LCARSHeader title="CAPACITOR COMMAND" subTitle="DIAGNOSTIC SUBROUTINE v2.4" />

                    <div className="px-5 flex-1">
                        
                        {/* SYSTEM IDENTITY INPUTS */}
                        <div className="mb-6 border-l-4 border-[#cc99cc] pl-4 py-1">
                            <h3 className="text-[#cc99cc] text-sm font-bold mb-3 lcars-text tracking-widest">SYSTEM IDENTITY</h3>
                            <div className="space-y-3">
                                <FormField type="text" label="SYSTEM NAME / LOCATION" placeholder="E.G. UPSTAIRS HALL" value={sysInfo.name} onChange={e => setSysInfo({...sysInfo, name: e.target.value})} color="#cc99cc" />
                                <FormField type="text" label="MANUFACTURER" placeholder="E.G. CARRIER" value={sysInfo.mfg} onChange={e => setSysInfo({...sysInfo, mfg: e.target.value})} color="#cc99cc" />
                                <div className="grid grid-cols-2 gap-3">
                                    <FormField type="text" label="MODEL NUMBER" placeholder="MODEL" value={sysInfo.model} onChange={e => setSysInfo({...sysInfo, model: e.target.value})} color="#cc99cc" />
                                    <FormField type="text" label="SERIAL NUMBER" placeholder="SERIAL" value={sysInfo.serial} onChange={e => setSysInfo({...sysInfo, serial: e.target.value})} color="#cc99cc" />
                                </div>
                            </div>
                        </div>

                        {/* MODE SELECTOR */}
                        <div className="grid grid-cols-2 gap-2 mb-6 border-t border-[#333] pt-4">
                            <button onClick={() => setMode('single')} className={`h-12 rounded-lg font-bold text-lg lcars-text transition-all ${mode === 'single' ? 'bg-[#ff9c00] text-black' : 'bg-[#333] text-[#666]'}`}>SINGLE RUN</button>
                            <button onClick={() => setMode('dual')} className={`h-12 rounded-lg font-bold text-lg lcars-text transition-all ${mode === 'dual' ? 'bg-[#ff9c00] text-black' : 'bg-[#333] text-[#666]'}`}>DUAL RUN</button>
                        </div>

                        {/* INPUTS AREA */}
                        <div className="space-y-6 pb-24">
                            {mode === 'single' && (
                                <div className="animate-fade-in border-l-4 border-[#99ccff] pl-4 py-2">
                                    <h3 className="text-[#99ccff] text-xl font-bold mb-4 lcars-text">CAPACITOR A</h3>
                                    
                                    <div className="mb-4">
                                         <FormField label="VOLTAGE (V)" placeholder="370" value={singleVoltage} onChange={(e) => setSingleVoltage(e.target.value)} color="#ffcc99" />
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-6">
                                        <FormField label="RATED µF" placeholder="45" value={singleRated} onChange={(e) => setSingleRated(e.target.value)} color="#99ccff" />
                                        <FormField label="START AMPS" placeholder="5.2" value={singleAmps} onChange={(e) => setSingleAmps(e.target.value)} color="#99ccff" />
                                    </div>
                                    <div className="mt-6">
                                        <ResultCard title="DIAGNOSTIC STATUS" result={singleResult} />
                                    </div>
                                </div>
                            )}

                            {mode === 'dual' && (
                                <div className="space-y-8">
                                    {/* HERM */}
                                    <div className="animate-fade-in border-l-4 border-[#99ccff] pl-4 py-2">
                                        <h3 className="text-[#99ccff] text-xl font-bold mb-4 lcars-text">HERM (COMPRESSOR)</h3>
                                        
                                        <div className="mb-4">
                                            <FormField label="VOLTAGE (V)" placeholder="370" value={hermVoltage} onChange={(e) => setHermVoltage(e.target.value)} color="#ffcc99" />
                                        </div>

                                        <div className="grid grid-cols-2 gap-6">
                                            <FormField label="RATED µF" placeholder="45" value={hermRated} onChange={(e) => setHermRated(e.target.value)} color="#99ccff" />
                                            <FormField label="AMPS" placeholder="5.2" value={hermAmps} onChange={(e) => setHermAmps(e.target.value)} color="#99ccff" />
                                        </div>
                                        <div className="mt-4">
                                            <ResultCard title="HERM STATUS" result={hermResult} />
                                        </div>
                                    </div>

                                    {/* FAN */}
                                    <div className="animate-fade-in border-l-4 border-[#cc99cc] pl-4 py-2">
                                        <h3 className="text-[#cc99cc] text-xl font-bold mb-4 lcars-text">FAN (MOTOR)</h3>
                                        
                                        <div className="mb-4">
                                            <FormField label="VOLTAGE (V)" placeholder="370" value={fanVoltage} onChange={(e) => setFanVoltage(e.target.value)} color="#ffcc99" />
                                        </div>

                                        <div className="grid grid-cols-2 gap-6">
                                            <FormField label="RATED µF" placeholder="5" value={fanRated} onChange={(e) => setFanRated(e.target.value)} color="#cc99cc" />
                                            <FormField label="AMPS" placeholder="0.6" value={fanAmps} onChange={(e) => setFanAmps(e.target.value)} color="#cc99cc" />
                                        </div>
                                        <div className="mt-4">
                                            <ResultCard title="FAN STATUS" result={fanResult} />
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Footer Attribution */}
                    <div className="text-center pb-24 px-4 opacity-40">
                         <p className="text-[#ff9c00] text-xs font-mono tracking-widest uppercase">Created by Clint Glasgow and his silicon buddy Gemini</p>
                    </div>

                    {/* FOOTER CONTROLS */}
                     <div className="fixed bottom-0 left-0 right-0 p-4 bg-black border-t-2 border-[#333] flex justify-center gap-4 z-50 max-w-xl mx-auto flex-wrap">
                        {/* Training Video Link */}
                        <LCARSButton onClick={openTrainingVideo} text="VISUAL LOG" color="bg-[#cc6666]" icon={<Icons.Video size={18}/>} />

                        {(singleResult || hermResult || fanResult) && (
                            <>
                                <LCARSButton onClick={copyToClipboard} text="COPY LOG" color="bg-[#99ccff]" icon={<Icons.Copy size={18}/>} />
                                <LCARSButton onClick={downloadTxt} text="SAVE FILE" color="bg-[#ffcc99]" icon={<Icons.Save size={18}/>} />
                            </>
                        )}
                        <button onClick={clearAll} className="w-12 h-10 rounded-full border border-[#cc6666] text-[#cc6666] flex items-center justify-center hover:bg-[#cc6666] hover:text-black transition-colors"><Icons.Trash size={18}/></button>
                    </div>

                </div>
            );
        }

        function ResultCard({ title, result }) {
            if (!result) return <div className="p-3 border-2 border-dashed border-[#333] text-[#444] text-center text-xs font-bold tracking-widest">AWAITING INPUT</div>;

            const isPass = result.passed;
            // Pass = Blue, Fail = Red
            const borderColor = isPass ? '#99ccff' : '#cc6666';
            const textColor = isPass ? '#99ccff' : '#cc6666';
            const statusText = isPass ? "OPTIMAL" : "CRITICAL FAILURE";

            return (
                <div className="relative bg-[#111] overflow-hidden" style={{
                    borderRight: `8px solid ${borderColor}`,
                    borderBottom: `2px solid ${borderColor}`,
                    borderTop: `1px solid #333`,
                    borderLeft: `1px solid #333`,
                    borderRadius: '0 0 10px 0'
                }}>
                    {/* Header Strip */}
                    <div className="flex justify-between items-center bg-black p-2 border-b border-[#333]">
                        <span className="text-[10px] text-[#888] font-bold tracking-widest">{title}</span>
                        <span className={`text-xs font-bold px-2 py-0.5 ${isPass ? 'bg-[#99ccff] text-black' : 'bg-[#cc6666] text-white animate-pulse'}`}>
                            {statusText}
                        </span>
                    </div>
                    
                    <div className="p-4 grid grid-cols-2">
                        <div>
                            <div className="text-4xl font-bold lcars-text text-white leading-none">{result.calculated}</div>
                            <div className="text-xs text-[#666] font-mono mt-1">RATED: {result.rated} µF</div>
                        </div>
                        <div className="text-right flex flex-col justify-center">
                            <div className="text-2xl font-bold" style={{color: textColor}}>
                                {result.percentOff > 0 ? '+' : ''}{result.percentOff}%
                            </div>
                            <div className="text-[9px] uppercase font-bold text-[#666]">VARIANCE</div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
